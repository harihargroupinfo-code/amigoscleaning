<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard | Amigos</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Font Awesome -->
<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: #f4f6f7;
}

/* HEADER */
header {
  background: linear-gradient(135deg,#1e8449,#27ae60);
  color: #fff;
  padding: 15px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

header h1 {
  font-size: 18px;
  margin: 0;
}

header button {
  background: #fff;
  color: #1e8449;
  border: none;
  padding: 8px 14px;
  border-radius: 20px;
  cursor: pointer;
  font-weight: 600;
}

/* CONTAINER */
.container {
  padding: 15px;
  max-width: 1100px;
  margin: auto;
}

/* FILTER */
.filter {
  margin-bottom: 15px;
}

.filter select {
  padding: 8px;
  border-radius: 6px;
  border: 1px solid #ccc;
}

/* TABLE */
table {
  width: 100%;
  border-collapse: collapse;
  background: #fff;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 10px 25px rgba(0,0,0,0.1);
}

th, td {
  padding: 10px;
  text-align: left;
  font-size: 13px;
}

th {
  background: #27ae60;
  color: #fff;
}

tr:nth-child(even) {
  background: #f2f2f2;
}

/* STATUS */
.status-approved { color: green; font-weight: 600; }
.status-pending { color: orange; font-weight: 600; }

/* BUTTONS */
.action-btn {
  padding: 6px 10px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  font-size: 12px;
}

.approve-btn {
  background: #27ae60;
  color: #fff;
}

.delete-btn {
  background: #c0392b;
  color: #fff;
}

/* MOBILE */
@media (max-width: 768px) {
  table, thead, tbody, th, td, tr {
    display: block;
  }

  thead { display: none; }

  tr {
    margin-bottom: 15px;
    border-bottom: 2px solid #ccc;
  }

  td {
    display: flex;
    justify-content: space-between;
  }

  td::before {
    content: attr(data-label);
    font-weight: bold;
  }
}
</style>
</head>

<body>

<header>
  <h1><i class="fa fa-user-shield"></i> Admin Dashboard</h1>
  <button onclick="logout()">Logout</button>
</header>

<div class="container">

  <div class="filter">
    <label>Filter Role:</label>
    <select onchange="loadUsers(this.value)">
      <option value="all">All</option>
      <option value="retailer">Retailers</option>
      <option value="distributor">Distributors</option>
    </select>
  </div>

  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Mobile</th>
        <th>Role</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="userTable"></tbody>
  </table>

</div>

<script>
/* ðŸ” ADMIN SECURITY */
if (
  localStorage.getItem("isLoggedIn") !== "true" ||
  localStorage.getItem("userRole") !== "admin"
) {
  window.location.href = "login.html";
}

/* LOAD USERS */
function loadUsers(filter = "all") {
  const users = JSON.parse(localStorage.getItem("users")) || [];
  const table = document.getElementById("userTable");
  table.innerHTML = "";

  users.forEach((u, i) => {
    if (filter !== "all" && u.role !== filter) return;

    let statusText = u.approved ? "Approved" : "Pending";
    let statusClass = u.approved ? "status-approved" : "status-pending";

    let actionBtns = "";

    if (u.role === "distributor" && !u.approved) {
      actionBtns += `
        <button class="action-btn approve-btn"
          onclick="approveUser(${i})">
          Approve
        </button>
      `;
    }

    actionBtns += `
      <button class="action-btn delete-btn"
        onclick="deleteUser(${i})">
        Delete
      </button>
    `;

    table.innerHTML += `
      <tr>
        <td data-label="Name">${u.name}</td>
        <td data-label="Email">${u.email}</td>
        <td data-label="Mobile">${u.mobile}</td>
        <td data-label="Role">${u.role}</td>
        <td data-label="Status" class="${statusClass}">
          ${statusText}
        </td>
        <td data-label="Action">${actionBtns}</td>
      </tr>
    `;
  });
}

/* APPROVE DISTRIBUTOR */
function approveUser(index) {
  let users = JSON.parse(localStorage.getItem("users")) || [];
  users[index].approved = true;
  localStorage.setItem("users", JSON.stringify(users));
  alert("Distributor approved successfully");
  loadUsers();
}

/* DELETE USER */
function deleteUser(index) {
  if (!confirm("Are you sure you want to DELETE this user?")) return;
  let users = JSON.parse(localStorage.getItem("users")) || [];
  users.splice(index, 1);
  localStorage.setItem("users", JSON.stringify(users));
  loadUsers();
}

/* LOGOUT */
function logout() {
  localStorage.clear();
  window.location.href = "login.html";
}

/* INIT */
loadUsers();
</script>

</body>
</html>
